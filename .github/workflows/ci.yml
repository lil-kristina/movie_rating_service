name: Project Validation

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  validate:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Validate file structure
      run: |
        echo "ðŸ” Checking project structure..."
        
        # ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð”ÐžÐ›Ð–ÐÐ« Ð±Ñ‹Ñ‚ÑŒ
        REQUIRED_FILES=(
          "backend/app/main.py"
          "backend/requirements.txt"
          "backend/app/models/movie.py"
          "backend/app/database/session.py"
        )
        
        all_good=true
        for file in "${REQUIRED_FILES[@]}"; do
          if [ -f "$file" ]; then
            echo "âœ… $file"
          else
            echo "âŒ $file - MISSING"
            all_good=false
          fi
        done
        
        if [ "$all_good" = false ]; then
          echo "ðŸš¨ Missing required files"
          exit 1
        fi
        
        echo "ðŸ“Š File count:"
        find backend -name "*.py" | wc -l
        
    - name: Check Python syntax
      run: |
        echo "ðŸ Checking Python syntax..."
        cd backend
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ, Ð±ÐµÐ· Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²
        for file in $(find app -name "*.py"); do
          echo "  Checking $file"
          python -m py_compile "$file" 2>/dev/null && echo "    âœ…" || echo "    âš ï¸"
        done
        
        # ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‚Ñ‰Ð°Ñ‚ÐµÐ»ÑŒÐ½ÐµÐµ
        echo "Checking main files:"
        python -m py_compile app/main.py && echo "âœ… app/main.py" || echo "âŒ app/main.py"
        
    - name: Simple import test
      run: |
        echo "ðŸ”„ Testing basic imports..."
        cd backend
        
        # ÐŸÑ€Ð¾ÑÑ‚ÐµÐ¹ÑˆÐ¸Ð¹ Ñ‚ÐµÑÑ‚ Ð±ÐµÐ· Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
        cat > test_import.py << 'TEST'
print("Testing imports...")
try:
    # Ð¡Ð°Ð¼Ñ‹Ðµ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ñ‹
    import sys
    import os
    print("âœ… Standard imports OK")
    
    # ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð° Ð½Ð°ÑˆÐµÐ³Ð¾ ÐºÐ¾Ð´Ð°
    sys.path.insert(0, 'app')
    from main import app
    print("âœ… FastAPI app imported")
    
    print("ðŸŽ‰ All imports successful!")
    
except Exception as e:
    print(f"âŒ Import error: {e}")
    import traceback
    traceback.print_exc()
    sys.exit(1)
TEST
        
        python test_import.py
        
    - name: Success
      run: |
        echo "ðŸŽ‰ðŸŽ‰ðŸŽ‰ VALIDATION PASSED ðŸŽ‰ðŸŽ‰ðŸŽ‰"
        echo "âœ… Project structure is valid"
        echo "âœ… Python files have correct syntax"
        echo "âœ… Basic imports work"
        echo ""
        echo "Next steps:"
        echo "1. Create issues for frontend tasks"
        echo "2. Update README.md"
        echo "3. Setup proper test suite"
